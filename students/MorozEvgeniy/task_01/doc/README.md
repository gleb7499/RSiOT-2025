# Министерство образования Республики Беларусь

<p align="center">Учреждение образования</p>
<p align="center">“Брестский Государственный технический университет”</p>
<p align="center">Кафедра ИИТ</p>

<p align="center"><strong>Лабораторная работа №1</strong></p>
<p align="center"><strong>По дисциплине:</strong> “РСиОТ”</p>
<p align="center"><strong>Тема:</strong> “Контейнеризация и Docker”</p>

<p align="right"><strong>Выполнил:</strong></p>
<p align="right">Студент 4 курса</p>
<p align="right">Группы АС-63</p>
<p align="right">Мороз Е. В.</p>
<p align="right"><strong>Проверил:</strong></p>
<p align="right">Несюк А.Н.</p>

<p align="center"><strong>Брест 2025</strong></p>

---

## Цель работы

Освоить основы контейнеризации с использованием Docker, научиться собирать минимальные образы (multi-stage build), работать с volume, сетями, и docker-compose, а также реализовать graceful shutdown и healthcheck для сервисов.

---

### Вариант №18

| Параметр            | Значение                  |
|---------------------|---------------------------|
| Стек                | Go (net/http)             |
| Порт приложения     | 8063                      |
| Healthcheck endpoint| `/ping`                   |
| Зависимость         | Redis                |
| Volume              | `data_v15`   |
| UID                 | 65532                     |
| Тег                 | `v15`                     |

---

## Ход выполнения работы

### 1. Структура проекта

- `Dockerfile` — multi-stage сборка Go-приложения
- `docker-compose.yml` — оркестрация приложения (app) и базы данных (redis)
- `main.go` — исходный код HTTP-сервиса на Go (net/http) с использованием Redis для подсчета посещений
- `.dockerignore` — правила игнорирования файлов при сборке образа
- `README.md` — отчёт и инструкции

---

### 2. Dockerfile (основные моменты)
Dockerfile использует multi-stage build, что позволяет получить минимальный финальный образ.

Этап builder: используется образ `golang:1.25-alpine` для сборки приложения.

Этап final: используется минимальный образ `alpine:latest`.

Ненулевой UID: Задается пользователь appuser с UID 65532 (через adduser -u 65532), что соответствует требованиям безопасности.

`RUN addgroup -S appgroup && adduser -S appuser -G appgroup -u 65532`

`USER appuser`

Порт: Приложение открывает порт 8063.

`EXPOSE 8063`

HEALTHCHECK: Настроен эндпоинт /ping с использованием curl.

`HEALTHCHECK --interval=15s --timeout=3s --start-period=5s --retries=3 \`

`CMD curl -f http://localhost:8063/ping || exit 1`

Метаданные (LABEL): Указаны все необходимые метаданные студента.

### 3. docker-compose.yml

3. docker-compose.yml
Файл оркестрации включает два сервиса: app (Go-приложение) и redis (база данных).

Slug: Определен слаг для уникальности ресурсов: `as-63-220019-v15`.

Сервис app:

Имя контейнера: `app-as-63-220019-v15`.

Проброс порта: 8063 (хост) на 8063 (контейнер).

Зависимость: `depends_on: [redis]`.

Переменные окружения: `APP_PORT=8063`, `REDIS_ADDR=redis:6379`, `STU_ID=220019`, `STU_GROUP=АС-63`, `STU_VARIANT=15`.

Сервис `redis`:

Образ: `redis:7-alpine`.

Имя контейнера: `redis-as-63-220019-v15`.

Volume: Подключен именованный том `data-as-63-220019-v15` для хранения данных Redis в папке `/data`.

Сеть: Оба сервиса подключены к общей сети `net-as-63-220019-v15`.

---

### 4. Реализация graceful shutdown

В коде Go-приложения реализована обработка системных сигналов SIGINT и SIGTERM, что обеспечивает плавное (graceful) завершение работы сервера. Это позволяет корректно завершить обработку активных запросов перед остановкой контейнера:

```go

    quit := make(chan os.Signal, 1)
	signal.Notify(quit, syscall.SIGINT, syscall.SIGTERM) 

	<-quit 
	log.Println("Получен сигнал для завершения работы. Начинаю остановку сервера...")

	ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second) 
	defer cancel()

	if err := server.Shutdown(ctx); err != nil {}

```

При остановке контейнера (`docker compose down`) сервис корректно завершает работу, закрывая соединение с БД и завершая все активные запросы.

---

### 5. Проверка работы

#### Запуск

```bash

docker compose up --build

```

### Эндпоинты приложения:

`/ping — Healthcheck`, возвращает OK.

`/` — Основной эндпоинт, увеличивает счетчик посещений в Redis и выводит информацию о студенте.

### Проверка healthcheck

После запуска контейнера, его работоспособность можно проверить с помощью:

`$ curl http://localhost:8063/ping`
`OK`

### Проверка основного эндпоинта

Каждый запрос к основному эндпоинту увеличивает счетчик в Redis.

`$ curl http://localhost:8063/`
`Привет от студента! ID: 220019, Группа: АС-63, Вариант: 15`
`Это посещение номер: 1`

`$ curl http://localhost:8063/`
`Привет от студента! ID: 220019, Группа: АС-63, Вариант: 15`
`Это посещение номер: 2`

### Корректное завершение (пример логов)

При остановке через docker compose down в логах приложения будет видна отработка graceful shutdown.

`app-as-63-220019-v15  | Получен сигнал для завершения работы. Начинаю остановку сервера...`
`app-as-63-220019-v15  | Сервер успешно остановлен.`

---

### 6. Проверка требований

| Критерий | Выполнено | Комментарий |
|-----------|-----------|--------------|
| Multi-stage build | ✅ | Сборка с golang:1.25-alpine в alpine:latest |
| USER ненулевой | ✅ | Пользователь appuser с UID 65532 |
| EXPOSE / HEALTHCHECK | ✅ | порт 8063, /ping |
| ENV конфигурация | ✅ | все переменные заданы |
| docker-compose (app + db + volume + network) | ✅ | корректно оформлено |
| Graceful shutdown | ✅ | через `server.Shutdown` |
| Кэширование зависимостей | ✅ | с `--mount=type=cache` |
| LABEL / slug / теги образов | ✅ | все поля присутствуют |
| README и отчёт | ✅ | оформлено в соответствии с ТЗ |

---

## Метаданные студента

| Поле | Значение |
|------|-----------|
| **ФИО** | Мороз Евгений Васильевич |
| **Группа** | АС-63 |
| **StudentID** | 220019 |
| **Email (учебный)** | emoroz321@gmail.com |
| **GitHub username** | EugeneFr0st |
| **Вариант** | 15 |
| **ОС / Docker** | W10, Docker Desktop 4.44.3 |
| **Slug** | as-63-220019-v15 |

---

## Вывод

В ходе лабораторной работы:
- Собран **минимальный контейнеризированный Go-сервис** (≤150 MB)
- Настроен **PostgreSQL** как зависимость
- Реализован **graceful shutdown** и **healthcheck**
- Использованы **multi-stage build** и **кэширование зависимостей**
- Все требования по **метаданным**, **именованию**, **volume** и **сетям** выполнены

Работа продемонстрировала навыки практической контейнеризации и сборки production-ready образов с использованием Docker и Docker Compose.
