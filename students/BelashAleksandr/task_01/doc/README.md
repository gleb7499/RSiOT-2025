# Лабораторная работа №01

<p align="center">Министерство образования Республики Беларусь</p>
<p align="center">Учреждение образования</p>
<p align="center">"Брестский Государственный технический университет"</p>
<p align="center">Кафедра ИИТ</p>
<br><br><br><br><br><br>
<p align="center"><strong>Лабораторная работа №01</strong></p>
<p align="center"><strong>По дисциплине:</strong> "Распределенные системы и облачные технологии"</p>
<p align="center"><strong>Тема:</strong> Контейнеризация и Docker</p>
<br><br><br><br><br><br>
<p align="right"><strong>Выполнил:</strong></p>
<p align="right">Студент 4 курса</p>
<p align="right">Группы АС-64</p>
<p align="right">Белаш А. О.</p>
<p align="right"><strong>Проверил:</strong></p>
<p align="right">Несюк А. Н.</p>
<br><br><br><br><br>
<p align="center"><strong>Брест 2025</strong></p>

---

## Цель работы

Научиться собирать минимальные образы (multi-stage) и запускать контейнеры под непривилегированным пользователем. Закрепить основы docker-compose: зависимости (БД/кэш), volume, сети. Настроить healthcheck и graceful shutdown.

---

### Вариант №25

## Метаданные студента

- **ФИО:** Белаш Александр Олегович
- **Группа:** АС-64
- **№ студенческого (StudentID):** 220031
- **Email (учебный):** <AS006401@g.bstu.by>
- **GitHub username:** went2smoke
- **Вариант №:** 25
- **ОС и версия:** Windows 11 25H2, Docker Desktop v4.5.0

---

## Окружение и инструменты

В рамках данной лабораторной работы использовались следующие инструменты и технологии согласно варианту №25:

- **Язык и фреймворк:** Node.js с Express
- **База данных/кэш:** Redis
- **Порт приложения:** 8031
- **Health-check endpoint:** `/ping`
- **Volume для данных:** `data-as64-220031-v25`
- **UID пользователя:** 65532
- **Тег образа:** `stu-220031-v25`
- **Docker:** Docker Desktop v4.5.0
- **ОС:** Windows 11 25H2

## Структура репозитория c описанием содержимого

```text
task_01/
├── src/                     # Исходные коды приложения
│   ├── server.js           # Основной файл Node/Express приложения
│   ├── package.json        # Зависимости npm
│   ├── Dockerfile          # Multi-stage Dockerfile с метаданными
│   └── .dockerignore       # Исключения при сборке образа
├── docker-compose.yml      # Конфигурация сервисов (app + redis)
└── doc/
    └── README.md           # Данный файл с отчетом
```

---

## Подробное описание выполнения

### 1. Создание минимального HTTP-сервиса

Реализован простой HTTP-сервис на Node.js/Express с поддержкой:

- Endpoint `/ping` для health-check, который инкрементирует счетчик в Redis
- Endpoint `/` для базовой информации о сервисе
- Интеграция с Redis для хранения данных
- Конфигурация через переменные окружения (PORT, REDIS_HOST, STU_ID, STU_GROUP, STU_VARIANT)
- Логирование всех входящих запросов и действий приложения

Ключ в Redis использует формат: `stu:220031:v25:ping`

### 2. Dockerfile с multi-stage сборкой

Создан Dockerfile с двумя стадиями:

- **Builder stage:** установка зависимостей из `package.json`
- **Final stage:** копирование node_modules и исходников, создание непривилегированного пользователя (UID 65532)

В образе присутствуют:

- `LABEL` с метаданными студента (org.bstu.student.fullname, org.bstu.student.id, org.bstu.group, org.bstu.variant, org.bstu.course)
- `USER 65532` для запуска под непривилегированным пользователем
- `EXPOSE 8031` для открытия порта
- `HEALTHCHECK` для проверки доступности `/ping` endpoint

### 3. docker-compose.yml

Файл `docker-compose.yml` включает:

- Сервис `app`: сборка образа из Dockerfile, проброс порта 8031, переменные окружения
- Сервис `redis`: использование официального образа Redis 7-alpine
- Volume `data-as64-220031-v25` для персистентного хранения данных Redis
- Сеть `net-as64-220031-v25` для связи между контейнерами
- Labels с метаданными (org.bstu.owner, org.bstu.student.slug)
- `depends_on` для правильной последовательности запуска

Именование контейнеров, томов и сетей соответствует slug: `as64-220031-v25`

### 4. Graceful shutdown

В `server.js` реализована обработка сигналов SIGTERM и SIGINT:

- При получении сигнала выводится сообщение о начале graceful shutdown
- Закрывается HTTP сервер
- Закрывается соединение с Redis
- Логируется завершение процесса
- Устанавливается таймаут 10 секунд для принудительного завершения

### 5. Запуск и проверка

**Сборка и запуск:**

```bash
docker-compose up --build
```

**Проверка работы приложения:**

```bash
curl http://localhost:8031/ping
```

**Остановка с graceful shutdown:**

```bash
docker-compose down
```

В логах видны:

- Информация о старте сервиса с метаданными студента
- Подключение к Redis
- Обработка запросов
- Корректное завершение при получении SIGTERM

### 6. Кэширование зависимостей

В Dockerfile реализовано базовое кэширование:

- Сначала копируется только `package.json`
- Выполняется `npm ci --only=production`
- Затем копируется остальной код

Это позволяет Docker кэшировать слой с node_modules при неизменности зависимостей.

---

## Контрольный список (checklist)

- [✅] README с полными метаданными студента
- [✅] Dockerfile (multi-stage, non-root, labels)
- [✅] docker-compose.yml с сервисами app и redis
- [✅] Volume для данных Redis
- [✅] Сеть для связи контейнеров
- [✅] HEALTHCHECK в Dockerfile
- [✅] Graceful shutdown при SIGTERM
- [✅] Логирование старта и завершения
- [✅] Переменные окружения (STU_ID, STU_GROUP, STU_VARIANT)
- [✅] Именование по slug (as64-220031-v25)
- [✅] Redis с префиксом ключей stu:220031:v25

---

## Вывод

В ходе выполнения лабораторной работы был создан минимальный HTTP-сервис на Node.js/Express с интеграцией Redis. Реализован multi-stage Dockerfile для оптимизации размера образа, настроен запуск под непривилегированным пользователем (UID 65532). С помощью docker-compose настроено взаимодействие между приложением и Redis, созданы персистентные volume для хранения данных. Реализован graceful shutdown с корректной обработкой сигнала SIGTERM и логированием всех этапов работы приложения. Все артефакты содержат требуемые метаданные студента, именование соответствует slug формату.

Освоены базовые навыки контейнеризации приложений с использованием Docker и docker-compose.
