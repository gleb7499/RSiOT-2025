# –õ–µ–∫—Ü–∏—è 07. –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

**–¶–µ–ª—å –ª–µ–∫—Ü–∏–∏:** –ò–∑—É—á–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (—à–∞—Ä–¥–∏–Ω–≥/–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è, –æ—Å–≤–æ–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –Ω–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–Ω—è—Ç—å, –∫–∞–∫ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã —Å –≤—ã—Å–æ–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö.

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. **–ó–∞—á–µ–º –Ω—É–∂–Ω–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è, –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ.
2. **–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —à–∞—Ä–¥–∏–Ω–≥–∞:** Range-based (–ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É), Hash-based (–ø–æ —Ö–µ—à—É), Composite (–∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π).
3. **Consistent Hashing:** –ö–æ–ª—å—Ü–æ —Ö–µ—à–µ–π, –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–¥—ã, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
4. **–ü—Ä–æ–±–ª–µ–º–∞ –≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫ (Hotspots):** –ü—Ä–∏—á–∏–Ω—ã –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è, –º–µ—Ç–æ–¥—ã –±–æ—Ä—å–±—ã.
5. **–†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (Rebalancing):** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–æ–≤, –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
6. **–í—Ç–æ—Ä–∏—á–Ω—ã–µ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:** –õ–æ–∫–∞–ª—å–Ω—ã–µ vs –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏.
7. **–ì–µ–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** Latency-aware routing, –≥–µ–æ-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ë–î.
8. **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏:** L4 vs L7 –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏, –∞–ª–≥–æ—Ä–∏—Ç–º—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏, health checks.
9. **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è consistent hashing, —Å–∏–º—É–ª—è—Ü–∏—è —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏.

## –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —á—Ç–µ–Ω–∏—è

- [Dynamo: Amazon's Highly Available Key-value Store](https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf) ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è –æ consistent hashing
- [Designing Data-Intensive Applications, Chapter 6: Partitioning](https://dataintensive.net/) ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- [Consistent Hashing Explained](https://tom-e-white.com/2007/11/consistent-hashing.html) ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã
- [HAProxy Documentation](https://www.haproxy.org/documentation/) ‚Äî –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ L4/L7

---

## 1) –ó–∞—á–µ–º –Ω—É–∂–Ω–æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

–ö–æ–≥–¥–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å—Ç—ë—Ç, –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å –º–∏–ª–ª–∏–∞—Ä–¥–∞–º–∏ –∑–∞–ø–∏—Å–µ–π ‚Äî –¥–∞–∂–µ —Å–∞–º—ã–π –º–æ—â–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–ø—Ä–∞–≤–∏—Ç—Å—è —Å –Ω–∞–≥—Ä—É–∑–∫–æ–π.

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è

**–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** (Scale-Up) ‚Äî —ç—Ç–æ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç–∏ –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞: –±–æ–ª—å—à–µ CPU, RAM, –¥–∏—Å–∫–æ–≤.

**–ü—Ä–æ–±–ª–µ–º—ã:**

- **–§–∏–∑–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–ª–æ–∫:** –ù–µ–ª—å–∑—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –º–æ—â–Ω–æ—Å—Ç—å –æ–¥–Ω–æ–π –º–∞—à–∏–Ω—ã.
- **–°—Ç–æ–∏–º–æ—Å—Ç—å:** –£–¥–≤–æ–µ–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç–∏ –º–æ–∂–µ—Ç —É—Ç—Ä–æ–∏—Ç—å —Ü–µ–Ω—É.
- **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –æ—Ç–∫–∞–∑–∞:** –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–¥—ë—Ç, –≤—Å—è —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Å—Ç–∞–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.
- **Downtime:** –î–ª—è –∞–ø–≥—Ä–µ–π–¥–∞ —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É.

**–ü—Ä–∏–º–µ—Ä:** PostgreSQL –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —Å 1 –¢–ë RAM –º–æ–∂–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å ~100K –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫, –Ω–æ –¥–∞–ª—å—à–µ —É–ø–∏—Ä–∞–µ—Ç—Å—è –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.

### –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** (Scale-Out) ‚Äî —ç—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö/–Ω–∞–≥—Ä—É–∑–∫–∏ –º–µ–∂–¥—É –Ω–∏–º–∏.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:** –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞.
- **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:** –í—ã—Ö–æ–¥ –∏–∑ —Å—Ç—Ä–æ—è –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞ –Ω–µ —Ä–æ–Ω—è–µ—Ç –≤—Å—é —Å–∏—Å—Ç–µ–º—É.
- **–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –£–∑–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç–∞—Ü–µ–Ω—Ç—Ä–∞—Ö/—Ä–µ–≥–∏–æ–Ω–∞—Ö.
- **–≠–∫–æ–Ω–æ–º–∏—á–Ω–æ—Å—Ç—å:** –ú–Ω–æ–≥–æ –¥–µ—à—ë–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–µ—à–µ–≤–ª–µ –æ–¥–Ω–æ–≥–æ –º–æ—â–Ω–æ–≥–æ.

**–¶–µ–Ω–∞:** –°–ª–æ–∂–Ω–æ—Å—Ç—å ‚Äî –Ω—É–∂–Ω–æ —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏.

### –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (Sharding)

**–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã (–ø–∞—Ä—Ç–∏—Ü–∏–∏/—à–∞—Ä–¥—ã), –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω–∏—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–º —É–∑–ª–µ.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ú–æ–Ω–æ–ª–∏—Ç (1 TB) ‚îÇ  ‚Üí  –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–ª–æ–∂–Ω–æ, –¥–æ—Ä–æ–≥–æ)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

          ‚Üì –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –®–∞—Ä–¥ 1 ‚îÇ  ‚îÇ –®–∞—Ä–¥ 2 ‚îÇ  ‚îÇ –®–∞—Ä–¥ 3 ‚îÇ  ‚îÇ –®–∞—Ä–¥ 4 ‚îÇ
‚îÇ 250 GB ‚îÇ  ‚îÇ 250 GB ‚îÇ  ‚îÇ 250 GB ‚îÇ  ‚îÇ 250 GB ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
  –£–∑–µ–ª 1      –£–∑–µ–ª 2      –£–∑–µ–ª 3      –£–∑–µ–ª 4
```

**–¶–µ–ª—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:**

- **–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:** –ö–∞–∂–¥—ã–π —É–∑–µ–ª —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö.
- **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞:** –ó–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É–∑–ª–∞—Ö.
- **–ò–∑–æ–ª—è—Ü–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏:** –ü—Ä–æ–±–ª–µ–º—ã –Ω–∞ –æ–¥–Ω–æ–º —à–∞—Ä–¥–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ.

---

## 2) –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —à–∞—Ä–¥–∏–Ω–≥–∞

–ö–ª—é—á–µ–≤–æ–π –≤–æ–ø—Ä–æ—Å: **–ö–∞–∫ —Ä–µ—à–∏—Ç—å, –Ω–∞ –∫–∞–∫–æ–π —à–∞—Ä–¥ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å?**

### Range-based Sharding (–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É)

–î–∞–Ω–Ω—ã–µ –¥–µ–ª—è—Ç—Å—è –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –∑–Ω–∞—á–µ–Ω–∏–π –∫–ª—é—á–∞.

**–ü—Ä–∏–º–µ—Ä: –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ ID**

```
–®–∞—Ä–¥ 1: user_id 1-1,000,000
–®–∞—Ä–¥ 2: user_id 1,000,001-2,000,000
–®–∞—Ä–¥ 3: user_id 2,000,001-3,000,000
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –õ–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å, –≥–¥–µ –∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.
- **Range queries:** –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (`WHERE user_id BETWEEN 1000 AND 2000`).
- **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ:** –°–º–µ–∂–Ω—ã–µ –∫–ª—é—á–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ä—è–¥–æ–º (—Ö–æ—Ä–æ—à–æ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏).

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **Hotspots (–≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏):** –ï—Å–ª–∏ –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –≤—Å–µ–≥–¥–∞ –∏–¥—É—Ç –≤ –∫–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, auto-increment ID), –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞—Ä–¥ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç.
- **–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –û–¥–Ω–∏ –¥–∏–∞–ø–∞–∑–æ–Ω—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω–µ–µ –¥—Ä—É–≥–∏—Ö.

**–ü—Ä–∏–º–µ—Ä hotspot:**

```python
# –í—Å–µ –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∞ –®–∞—Ä–¥ 3
INSERT INTO users (id, name) VALUES (3000001, 'Alice');  # ‚Üí –®–∞—Ä–¥ 3
INSERT INTO users (id, name) VALUES (3000002, 'Bob');    # ‚Üí –®–∞—Ä–¥ 3
INSERT INTO users (id, name) VALUES (3000003, 'Charlie');# ‚Üí –®–∞—Ä–¥ 3
# –®–∞—Ä–¥—ã 1 –∏ 2 –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç!
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª—é—á–∏ —Å –≤—ã—Å–æ–∫–æ–π —ç–Ω—Ç—Ä–æ–ø–∏–µ–π (UUID, timestamp + random).

### Hash-based Sharding (–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ —Ö–µ—à—É)

–ü—Ä–∏–º–µ–Ω—è–µ–º —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—é –∫ –∫–ª—é—á—É, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —à–∞—Ä–¥.

```python
shard_id = hash(key) % num_shards
```

**–ü—Ä–∏–º–µ—Ä:**

```python
hash('user_12345') % 4 = 2  # ‚Üí –®–∞—Ä–¥ 2
hash('user_67890') % 4 = 0  # ‚Üí –®–∞—Ä–¥ 0
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:** –•–µ—à-—Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ.
- **–ù–µ—Ç hotspots:** –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∞ —Ä–∞–∑–Ω—ã–µ —à–∞—Ä–¥—ã.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **Range queries –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã:** `WHERE user_id BETWEEN 1000 AND 2000` —Ç—Ä–µ–±—É–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö —à–∞—Ä–¥–æ–≤.
- **–†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞:** –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —É–∑–ª–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Ö–µ—à–∏—Ä–æ–≤–∞—Ç—å –ø–æ—á—Ç–∏ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏:**

```python
# –ë—ã–ª–æ 4 —à–∞—Ä–¥–∞
hash('key_A') % 4 = 2  # –®–∞—Ä–¥ 2

# –î–æ–±–∞–≤–∏–ª–∏ 5-–π —à–∞—Ä–¥
hash('key_A') % 5 = 1  # –¢–µ–ø–µ—Ä—å –®–∞—Ä–¥ 1 (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å!)
```

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞—Ä–¥–æ–≤ **–±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–ª—é—á–µ–π –º–µ–Ω—è—é—Ç —à–∞—Ä–¥** ‚Üí –º–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.

**–†–µ—à–µ–Ω–∏–µ:** Consistent Hashing (—Å–º. —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞–∑–¥–µ–ª).

### Composite Sharding (–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

–ö–æ–º–±–∏–Ω–∞—Ü–∏—è range –∏ hash ‚Äî —Å–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∏–º –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É, –∑–∞—Ç–µ–º –ø–æ —Ö–µ—à—É –≤–Ω—É—Ç—Ä–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞.

**–ü—Ä–∏–º–µ—Ä: –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏ —Ö–µ—à—É**

```
–®–∞—Ä–¥ 1: logs 2024-01-01 –¥–æ 2024-01-31, hash(log_id) % 4 == 0
–®–∞—Ä–¥ 2: logs 2024-01-01 –¥–æ 2024-01-31, hash(log_id) % 4 == 1
–®–∞—Ä–¥ 3: logs 2024-02-01 –¥–æ 2024-02-28, hash(log_id) % 4 == 0
–®–∞—Ä–¥ 4: logs 2024-02-01 –¥–æ 2024-02-28, hash(log_id) % 4 == 1
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **Range queries –ø–æ –≤—Ä–µ–º–µ–Ω–∏:** –ú–æ–∂–Ω–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ –ø–µ—Ä–∏–æ–¥.
- **–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å –≤–Ω—É—Ç—Ä–∏ –ø–µ—Ä–∏–æ–¥–∞:** –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç hotspots.

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** Timeseries –ë–î (InfluxDB, TimescaleDB), –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (Elasticsearch).

### –í—ã–±–æ—Ä –∫–ª—é—á–∞ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–±–æ—Ä–∞:**

1. **–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å:** –ö–ª—é—á –¥–æ–ª–∂–µ–Ω –¥–∞–≤–∞—Ç—å —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö.
2. **–õ–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å:** –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–∞ –æ–¥–Ω–æ–º —à–∞—Ä–¥–µ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å JOIN —á–µ—Ä–µ–∑ —Å–µ—Ç—å).
3. **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å:** –ö–ª—é—á –Ω–µ –¥–æ–ª–∂–µ–Ω –º–µ–Ω—è—Ç—å—Å—è (–∏–Ω–∞—á–µ –∑–∞–ø–∏—Å—å –ø–µ—Ä–µ–µ–¥–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π —à–∞—Ä–¥).

**–ü—Ä–∏–º–µ—Ä—ã:**

- **–•–æ—Ä–æ—à–∏–µ –∫–ª—é—á–∏:** UUID, hash(email), tenant_id (–¥–ª—è multi-tenant SaaS).
- **–ü–ª–æ—Ö–∏–µ –∫–ª—é—á–∏:** Auto-increment ID (hotspots), timestamp (–Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å).

---

## 3) Consistent Hashing ‚Äî –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

Consistent Hashing —Ä–µ—à–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É hash-based sharding: –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —É–∑–ª–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è **–º–∏–Ω–∏–º—É–º –¥–∞–Ω–Ω—ã—Ö** (–≤ —Å—Ä–µ–¥–Ω–µ–º `K/N`, –≥–¥–µ `K` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π, `N` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤).

### –ö–æ–ª—å—Ü–æ —Ö–µ—à–µ–π

–ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º —Ö–µ—à-—Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –∫–æ–ª—å—Ü–æ –æ—Ç 0 –¥–æ $2^{32}-1$ (–∏–ª–∏ $2^{64}-1$ –¥–ª—è MD5/SHA-1).

```
         0
         ‚Üë
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  3 ‚îÇ         ‚îÇ 1
    ‚îÇ  –ö–æ–ª—å—Ü–æ ‚îÇ
  2 ‚îÇ         ‚îÇ 4
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ê–ª–≥–æ—Ä–∏—Ç–º:**

1. **–•–µ—à–∏—Ä—É–µ–º —É–∑–ª—ã:** –ö–∞–∂–¥–æ–º—É —É–∑–ª—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –∫–æ–ª—å—Ü–µ.
   - `hash("Node_A")` ‚Üí 100
   - `hash("Node_B")` ‚Üí 250
   - `hash("Node_C")` ‚Üí 400

2. **–•–µ—à–∏—Ä—É–µ–º –∫–ª—é—á–∏:** –ö–∞–∂–¥–æ–º—É –∫–ª—é—á—É –ø—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ –∫–æ–ª—å—Ü–µ.
   - `hash("key_1")` ‚Üí 50
   - `hash("key_2")` ‚Üí 300

3. **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:** –ö–ª—é—á –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ **–ø–µ—Ä–≤—ã–π —É–∑–µ–ª –ø–æ —á–∞—Å–æ–≤–æ–π —Å—Ç—Ä–µ–ª–∫–µ**.

```
–ö–æ–ª—å—Ü–æ:
0 -------- 100 -------- 250 -------- 400 -------- 2^32-1
           Node_A       Node_B       Node_C

key_1 (50)   ‚Üí –∏–¥—ë—Ç –∫ Node_A (100)
key_2 (300)  ‚Üí –∏–¥—ë—Ç –∫ Node_C (400)
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞

–î–æ–±–∞–≤–ª—è–µ–º `Node_D` —Å `hash("Node_D")` ‚Üí 200.

```
0 -------- 100 -------- 200 -------- 250 -------- 400 -------- 2^32-1
           Node_A       Node_D       Node_B       Node_C
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**
- –ö–ª—é—á–∏ –º–µ–∂–¥—É 100 –∏ 200 (—Ä–∞–Ω—å—à–µ —à–ª–∏ –∫ `Node_B`) **–ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ `Node_D`**.
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ **–æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ —Å–≤–æ–∏—Ö —É–∑–ª–∞—Ö**.

**–ü–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è:** –¢–æ–ª—å–∫–æ $\frac{1}{N}$ –¥–∞–Ω–Ω—ã—Ö (–≥–¥–µ $N$ ‚Äî –Ω–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É–∑–ª–æ–≤).

–í –æ–±—ã—á–Ω–æ–º —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–∏ (`hash % N`) –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É–∑–ª–∞ **–ø–æ—á—Ç–∏ –≤—Å–µ –∫–ª—é—á–∏** –º–µ–Ω—è—é—Ç —à–∞—Ä–¥.

### –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–¥—ã (Virtual Nodes)

–ü—Ä–æ–±–ª–µ–º–∞: –ï—Å–ª–∏ —É–∑–ª–æ–≤ –º–∞–ª–æ, —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ö–∞–∂–¥—ã–π —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —É–∑–µ–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω **–Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏** –Ω–∞ –∫–æ–ª—å—Ü–µ.

```python
# –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π —Ç–æ—á–∫–∏ –¥–ª—è Node_A —Å–æ–∑–¥–∞—ë–º 100 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥
for i in range(100):
    hash(f"Node_A_{i}") ‚Üí —Ç–æ—á–∫–∞ –Ω–∞ –∫–æ–ª—å—Ü–µ
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å:** –ë–æ–ª—å—à–µ —Ç–æ—á–µ–∫ ‚Üí –±–æ–ª–µ–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.
- **–ì–∏–±–∫–æ—Å—Ç—å:** –ú–æ—â–Ω—ã–º —É–∑–ª–∞–º –º–æ–∂–Ω–æ –¥–∞—Ç—å –±–æ–ª—å—à–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥.

**–ü—Ä–∏–º–µ—Ä:** Cassandra –∏—Å–ø–æ–ª—å–∑—É–µ—Ç 256 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —É–∑–µ–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Python

```python
import hashlib

class ConsistentHash:
    def __init__(self, num_virtual_nodes=150):
        self.num_virtual_nodes = num_virtual_nodes
        self.ring = {}  # {hash_value: node_name}
        self.sorted_keys = []

    def _hash(self, key):
        """MD5 —Ö–µ—à, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–Ω—ã–π –≤ int"""
        return int(hashlib.md5(key.encode()).hexdigest(), 16)

    def add_node(self, node_name):
        """–î–æ–±–∞–≤–∏—Ç—å —É–∑–µ–ª –Ω–∞ –∫–æ–ª—å—Ü–æ"""
        for i in range(self.num_virtual_nodes):
            virtual_key = f"{node_name}_{i}"
            hash_value = self._hash(virtual_key)
            self.ring[hash_value] = node_name
        self.sorted_keys = sorted(self.ring.keys())
        print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É–∑–µ–ª {node_name} ({self.num_virtual_nodes} –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥)")

    def remove_node(self, node_name):
        """–£–¥–∞–ª–∏—Ç—å —É–∑–µ–ª —Å –∫–æ–ª—å—Ü–∞"""
        for i in range(self.num_virtual_nodes):
            virtual_key = f"{node_name}_{i}"
            hash_value = self._hash(virtual_key)
            if hash_value in self.ring:
                del self.ring[hash_value]
        self.sorted_keys = sorted(self.ring.keys())
        print(f"‚ùå –£–¥–∞–ª—ë–Ω —É–∑–µ–ª {node_name}")

    def get_node(self, key):
        """–ù–∞–π—Ç–∏ —É–∑–µ–ª –¥–ª—è –∫–ª—é—á–∞"""
        if not self.ring:
            return None
        
        hash_value = self._hash(key)
        
        # –ë–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —É–∑–ª–∞ >= hash_value
        for ring_hash in self.sorted_keys:
            if ring_hash >= hash_value:
                return self.ring[ring_hash]
        
        # –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω–∞—á–∞–ª—É –∫–æ–ª—å—Ü–∞
        return self.ring[self.sorted_keys[0]]

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
ch = ConsistentHash(num_virtual_nodes=150)
ch.add_node("Node_A")
ch.add_node("Node_B")
ch.add_node("Node_C")

keys = ["user_123", "order_456", "product_789"]
for key in keys:
    node = ch.get_node(key)
    print(f"–ö–ª—é—á '{key}' ‚Üí {node}")

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —É–∑–µ–ª
ch.add_node("Node_D")
print("\n–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Node_D:")
for key in keys:
    node = ch.get_node(key)
    print(f"–ö–ª—é—á '{key}' ‚Üí {node}")
```

**–í—ã–≤–æ–¥:**

```
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É–∑–µ–ª Node_A (150 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É–∑–µ–ª Node_B (150 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É–∑–µ–ª Node_C (150 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥)
–ö–ª—é—á 'user_123' ‚Üí Node_C
–ö–ª—é—á 'order_456' ‚Üí Node_A
–ö–ª—é—á 'product_789' ‚Üí Node_B

‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —É–∑–µ–ª Node_D (150 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥)

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Node_D:
–ö–ª—é—á 'user_123' ‚Üí Node_C  (–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è)
–ö–ª—é—á 'order_456' ‚Üí Node_D  (–ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª—Å—è)
–ö–ª—é—á 'product_789' ‚Üí Node_B  (–Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è)
```

**–í—ã–≤–æ–¥:** –¢–æ–ª—å–∫–æ 1 –∏–∑ 3 –∫–ª—é—á–µ–π –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª—Å—è (33%), –∞ –Ω–µ –≤—Å–µ 3 (100%).

---

## 4) –ü—Ä–æ–±–ª–µ–º–∞ –≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫ (Hotspots)

**Hotspot** ‚Äî —ç—Ç–æ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –æ–¥–∏–Ω —à–∞—Ä–¥ –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤/–¥–∞–Ω–Ω—ã—Ö, –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ—Ç—Å—è, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ –¥—Ä—É–≥–∏–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç.

### –ü—Ä–∏—á–∏–Ω—ã –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è

1. **–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–ª—é—á–∏:** –ï—Å–ª–∏ –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å/–ø—Ä–æ–¥—É–∫—Ç –ø–æ–ª—É—á–∞–µ—Ç –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤.
   - **–ü—Ä–∏–º–µ—Ä:** –ü–æ—Å—Ç –∑–Ω–∞–º–µ–Ω–∏—Ç–æ—Å—Ç–∏ –≤ Twitter –ø–æ–ª—É—á–∞–µ—Ç –º–∏–ª–ª–∏–æ–Ω—ã –ª–∞–π–∫–æ–≤ ‚Üí —à–∞—Ä–¥ —Å —ç—Ç–∏–º –ø–æ—Å—Ç–æ–º –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω.

2. **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–∏:** Auto-increment ID, timestamp.
   - **–ü—Ä–∏–º–µ—Ä:** –í—Å–µ –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –ø–æ–ø–∞–¥–∞—é—Ç –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞—Ä–¥.

3. **–ù–µ—É–¥–∞—á–Ω—ã–π –≤—ã–±–æ—Ä –∫–ª—é—á–∞ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.**
   - **–ü—Ä–∏–º–µ—Ä:** –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–µ ‚Üí –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∑–∞ —Å–µ–≥–æ–¥–Ω—è –∏–¥—É—Ç –Ω–∞ –æ–¥–∏–Ω —à–∞—Ä–¥.

### –ú–µ—Ç–æ–¥—ã –±–æ—Ä—å–±—ã —Å hotspots

#### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —ç–Ω—Ç—Ä–æ–ø–∏–∏ –≤ –∫–ª—é—á

–í–º–µ—Å—Ç–æ `user_id` –∏—Å–ø–æ–ª—å–∑—É–µ–º `hash(user_id) + random_suffix`.

```python
# –ü–ª–æ—Ö–æ: –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –æ–¥–Ω–æ–º —à–∞—Ä–¥–µ
key = f"user_{user_id}"

# –•–æ—Ä–æ—à–æ: –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
import random
suffix = random.randint(0, 9)  # 10 –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
key = f"user_{user_id}_{suffix}"
```

**–¶–µ–Ω–∞:** –î–ª—è —á—Ç–µ–Ω–∏—è –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω—É–∂–Ω–æ –æ–ø—Ä–æ—Å–∏—Ç—å 10 –ø–∞—Ä—Ç–∏—Ü–∏–π.

#### 2. Pre-splitting (–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ)

–ó–∞—Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞—ë–º –±–æ–ª—å—à–µ —à–∞—Ä–¥–æ–≤, —á–µ–º —É–∑–ª–æ–≤.

```
4 —É–∑–ª–∞, 16 —à–∞—Ä–¥–æ–≤:
–£–∑–µ–ª 1: –®–∞—Ä–¥—ã 1, 5, 9, 13
–£–∑–µ–ª 2: –®–∞—Ä–¥—ã 2, 6, 10, 14
–£–∑–µ–ª 3: –®–∞—Ä–¥—ã 3, 7, 11, 15
–£–∑–µ–ª 4: –®–∞—Ä–¥—ã 4, 8, 12, 16
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ì–∏–±–∫–æ—Å—Ç—å: –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É–∑–ª–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —à–∞—Ä–¥–æ–≤, –Ω–µ —Ä–∞–∑–¥–µ–ª—è—è –∏—Ö.
- –ò–∑–æ–ª—è—Ü–∏—è: Hotspot –≤–ª–∏—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–∏–Ω —à–∞—Ä–¥, –Ω–µ –Ω–∞ –≤–µ—Å—å —É–∑–µ–ª.

**–ü—Ä–∏–º–µ—Ä:** HBase —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç pre-split —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ 100+ —Ä–µ–≥–∏–æ–Ω–æ–≤.

#### 3. Adaptive Sharding (–ê–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ)

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —à–∞—Ä–¥—ã.

```
–®–∞—Ä–¥ 1: 10 req/sec
–®–∞—Ä–¥ 2: 1000 req/sec  ‚Üê Hotspot!
–®–∞—Ä–¥ 3: 12 req/sec

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –®–∞—Ä–¥ 2:
–®–∞—Ä–¥ 2a: 500 req/sec
–®–∞—Ä–¥ 2b: 500 req/sec
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** MongoDB (auto-balancing), Google Bigtable, YugabyteDB.

#### 4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ Redis/Memcached, —Å–Ω–∏–∂–∞—è –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —à–∞—Ä–¥.

```python
def get_user(user_id):
    # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
    cached = redis.get(f"user:{user_id}")
    if cached:
        return cached
    
    # –ï—Å–ª–∏ –Ω–µ—Ç –≤ –∫—ç—à–µ, —á–∏—Ç–∞–µ–º –∏–∑ –ë–î
    user = db.query(f"SELECT * FROM users WHERE id = {user_id}")
    redis.setex(f"user:{user_id}", 3600, user)  # –ö—ç—à –Ω–∞ 1 —á–∞—Å
    return user
```

---

## 5) –†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ (Rebalancing)

–†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ ‚Äî –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —É–∑–ª–æ–≤ –∏–ª–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –Ω–∞–≥—Ä—É–∑–∫–∏.

### –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞:** –ù–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∏—Ç—å —á–∞—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –æ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö.
2. **–£–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞:** –î–∞–Ω–Ω—ã–µ —Å —É–¥–∞–ª—è–µ–º–æ–≥–æ —É–∑–ª–∞ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∞ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è.
3. **–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞:** –û–¥–∏–Ω —É–∑–µ–ª –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω, –¥—Ä—É–≥–∏–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç.

### –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

#### 1. Fixed Number of Partitions (–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π)

–°–æ–∑–¥–∞—ë–º –º–Ω–æ–≥–æ –ø–∞—Ä—Ç–∏—Ü–∏–π –∑–∞—Ä–∞–Ω–µ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000), —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –∏—Ö –ø–æ —É–∑–ª–∞–º.

```plaintext
–ù–∞—á–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (4 —É–∑–ª–∞, 16 –ø–∞—Ä—Ç–∏—Ü–∏–π):
–£–∑–µ–ª 1: P1, P2, P3, P4
–£–∑–µ–ª 2: P5, P6, P7, P8
–£–∑–µ–ª 3: P9, P10, P11, P12
–£–∑–µ–ª 4: P13, P14, P15, P16

–î–æ–±–∞–≤–ª—è–µ–º –£–∑–µ–ª 5:
–£–∑–µ–ª 1: P1, P2, P3       (–æ—Ç–¥–∞–ª P4 ‚Üí –£–∑–ª—É 5)
–£–∑–µ–ª 2: P5, P6, P7       (–æ—Ç–¥–∞–ª P8 ‚Üí –£–∑–ª—É 5)
–£–∑–µ–ª 3: P9, P10, P11     (–æ—Ç–¥–∞–ª P12 ‚Üí –£–∑–ª—É 5)
–£–∑–µ–ª 4: P13, P14, P15    (–æ—Ç–¥–∞–ª P16 ‚Üí –£–∑–ª—É 5)
–£–∑–µ–ª 5: P4, P8, P12, P16
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞:** –ü–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–µ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è, —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–º–µ—â–∞—é—Ç—Å—è.
- **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å:** –ó–∞—Ä–∞–Ω–µ–µ –∏–∑–≤–µ—Å—Ç–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö —Å—Ç–∞–ª–æ –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ, –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º–∏.
- **–†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞:** –ù—É–∂–Ω–æ –∑–∞—Ä–∞–Ω–µ–µ –≤—ã–±—Ä–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π.

**–ò—Å–ø–æ–ª—å–∑—É—é—Ç:** Riak, Elasticsearch, Couchbase.

#### 2. Dynamic Partitioning (–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

–ü–∞—Ä—Ç–∏—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –ø—Ä–∏ —Ä–æ—Å—Ç–µ –∏–ª–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏.

```plaintext
–ü–∞—Ä—Ç–∏—Ü–∏—è P1 –≤—ã—Ä–æ—Å–ª–∞ –¥–æ 10 GB:
P1 (10 GB) ‚Üí P1a (5 GB) + P1b (5 GB)

–ü–∞—Ä—Ç–∏—Ü–∏–∏ P5 –∏ P6 —É–º–µ–Ω—å—à–∏–ª–∏—Å—å –¥–æ 500 MB –∫–∞–∂–¥–∞—è:
P5 (500 MB) + P6 (500 MB) ‚Üí P5+6 (1 GB)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å:** –°–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ –æ–±—ä—ë–º –¥–∞–Ω–Ω—ã—Ö.
- **–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä:** –ü–∞—Ä—Ç–∏—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **–°–ª–æ–∂–Ω–æ—Å—Ç—å:** –ù—É–∂–Ω—ã –º–µ—Ö–∞–Ω–∏–∑–º—ã split/merge, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è.
- **Overhead:** Split/merge —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.

**–ò—Å–ø–æ–ª—å–∑—É—é—Ç:** HBase, MongoDB.

#### 3. Proportional Partitioning (–ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —É–∑–ª–æ–≤.

```plaintext
4 —É–∑–ª–∞, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç 64:
–ü–∞—Ä—Ç–∏—Ü–∏–π: 4 √ó 64 = 256

–î–æ–±–∞–≤–ª—è–µ–º 5-–π —É–∑–µ–ª:
–ü–∞—Ä—Ç–∏—Ü–∏–π: 5 √ó 64 = 320 (—Å–æ–∑–¥–∞—ë—Ç—Å—è 64 –Ω–æ–≤—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–∏)
```

**–ò—Å–ø–æ–ª—å–∑—É—é—Ç:** Cassandra (256 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥ –Ω–∞ —É–∑–µ–ª –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é).

### –ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

**–¶–µ–ª–∏:**

- –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö.
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏.
- –ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ç—å.

**–¢–µ—Ö–Ω–∏–∫–∏:**

1. **Consistent Hashing:** –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ $\frac{K}{N}$ –¥–∞–Ω–Ω—ã—Ö (–≥–¥–µ $K$ ‚Äî –∫–ª—é—á–∏, $N$ ‚Äî —É–∑–ª—ã).

2. **Incremental Transfer:** –î–∞–Ω–Ω—ã–µ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è —Å–∏—Å—Ç–µ–º—É.

```python
def rebalance_partition(old_node, new_node, partition_id):
    """–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏"""
    batch_size = 1000
    offset = 0
    
    while True:
        # –ö–æ–ø–∏—Ä—É–µ–º batch –¥–∞–Ω–Ω—ã—Ö
        data = old_node.read_partition(partition_id, offset, batch_size)
        if not data:
            break
        
        new_node.write_partition(partition_id, data)
        offset += batch_size
        
        # –ù–µ–±–æ–ª—å—à–∞—è –ø–∞—É–∑–∞, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å —Å–µ—Ç—å
        time.sleep(0.01)
    
    # –ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é
    update_routing_table(partition_id, new_node)
    
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
    old_node.delete_partition(partition_id)
```

3. **Background Rebalancing:** –†–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∏–¥—ë—Ç –≤ —Ñ–æ–Ω–µ, –Ω–µ –≤–ª–∏—è—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã.

---

## 6) –í—Ç–æ—Ä–∏—á–Ω—ã–µ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ª–æ–∂–Ω—è–µ—Ç —Ä–∞–±–æ—Ç—É —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏.

### –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (Document-partitioned indexes)

–ö–∞–∂–¥—ã–π —à–∞—Ä–¥ —Ö—Ä–∞–Ω–∏—Ç –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–∏—Ö –¥–∞–Ω–Ω—ã—Ö.

```plaintext
–®–∞—Ä–¥ 1: users id=1-1000
  - –ò–Ω–¥–µ–∫—Å –ø–æ email –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 1-1000

–®–∞—Ä–¥ 2: users id=1001-2000
  - –ò–Ω–¥–µ–∫—Å –ø–æ email –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π 1001-2000
```

**–ó–∞–ø—Ä–æ—Å –ø–æ –∏–Ω–¥–µ–∫—Å—É:**

```sql
SELECT * FROM users WHERE email = 'alice@example.com';
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –æ–ø—Ä–æ—Å–∏—Ç—å **–≤—Å–µ —à–∞—Ä–¥—ã** (scatter-gather), –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ –∑–Ω–∞–µ–º, –Ω–∞ –∫–∞–∫–æ–º —à–∞—Ä–¥–µ —ç—Ç–æ—Ç email.

```plaintext
–ö–ª–∏–µ–Ω—Ç ‚Üí –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä
         ‚Üì
  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
  ‚Üì      ‚Üì      ‚Üì
–®–∞—Ä–¥1  –®–∞—Ä–¥2  –®–∞—Ä–¥3
  ‚Üì      ‚Üì      ‚Üì
  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
    –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
         ‚Üì
      –ö–ª–∏–µ–Ω—Ç
```

**–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫:** –í—ã—Å–æ–∫–∞—è latency (–∑–∞–¥–µ—Ä–∂–∫–∞ = –º–∞–∫—Å–∏–º—É–º —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —à–∞—Ä–¥–æ–≤).

### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (Term-partitioned indexes)

–ò–Ω–¥–µ–∫—Å —Å–∞–º –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω –∏ –º–æ–∂–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –¥—Ä—É–≥–∏—Ö —É–∑–ª–∞—Ö.

```plaintext
–î–∞–Ω–Ω—ã–µ:
–®–∞—Ä–¥ 1: users id=1-1000
–®–∞—Ä–¥ 2: users id=1001-2000

–ò–Ω–¥–µ–∫—Å –ø–æ email (–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω –ø–æ hash(email)):
Index Shard A: emails a-m ‚Üí user_ids
Index Shard B: emails n-z ‚Üí user_ids
```

**–ó–∞–ø—Ä–æ—Å –ø–æ –∏–Ω–¥–µ–∫—Å—É:**

```sql
SELECT * FROM users WHERE email = 'alice@example.com';
```

1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º Index Shard: `hash('alice@example.com')` ‚Üí Index Shard A.
2. –ß–∏—Ç–∞–µ–º –∏–∑ Index Shard A: `user_id = 42`.
3. –û–ø—Ä–µ–¥–µ–ª—è–µ–º Data Shard: `42` ‚Üí –®–∞—Ä–¥ 1.
4. –ß–∏—Ç–∞–µ–º –∏–∑ –®–∞—Ä–¥ 1: –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–ë—ã—Å—Ç—Ä–æ–µ —á—Ç–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ 2 –∑–∞–ø—Ä–æ—Å–∞ (–∏–Ω–¥–µ–∫—Å + –¥–∞–Ω–Ω—ã–µ), –∞ –Ω–µ N (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —à–∞—Ä–¥–æ–≤).

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **–ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å:** –ü—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å:
  1. Data Shard (–æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ).
  2. Index Shard(s) (–≤—Å–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∏–Ω–¥–µ–∫—Å—ã).
- **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å:** –ò–Ω–¥–µ–∫—Å –º–æ–∂–µ—Ç –æ—Ç—Å—Ç–∞–≤–∞—Ç—å –æ—Ç –¥–∞–Ω–Ω—ã—Ö (eventual consistency).

**–†–µ—à–µ–Ω–∏–µ:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤.

```python
def create_user(user_data):
    # 1. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    data_shard.write(user_data)
    
    # 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –Ω–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –≤ –æ—á–µ—Ä–µ–¥—å
    task_queue.enqueue('update_email_index', user_data['email'], user_data['id'])
    
    return user_data['id']

# Worker –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∏–Ω–¥–µ–∫—Å
def update_email_index_worker(email, user_id):
    index_shard = get_index_shard(email)
    index_shard.add_entry(email, user_id)
```

**–ò—Å–ø–æ–ª—å–∑—É—é—Ç:**

- **–õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:** MongoDB, Cassandra.
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:** Elasticsearch (–≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω—ã), DynamoDB (Global Secondary Indexes).

---

## 7) –ì–µ–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –≤–∞–∂–Ω–æ —Ä–∞–∑–º–µ—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –±–ª–∏–∑–∫–æ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.

### –ü—Ä–æ–±–ª–µ–º–∞ latency

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –¢–æ–∫–∏–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –≤ –ò—Ä–ª–∞–Ω–¥–∏–∏:

```plaintext
–¢–æ–∫–∏–æ ‚Üí –ò—Ä–ª–∞–Ω–¥–∏—è: ~250 –º—Å (—Ç—É–¥–∞-–æ–±—Ä–∞—Ç–Ω–æ)
```

–î–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —ç—Ç–æ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ.

### –ì–µ–æ-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (Geo-partitioning)

–î–∞–Ω–Ω—ã–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä—É—é—Ç—Å—è –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–∑–Ω–∞–∫—É.

```plaintext
–®–∞—Ä–¥ EU: –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ï–≤—Ä–æ–ø—ã (–ò—Ä–ª–∞–Ω–¥–∏—è)
–®–∞—Ä–¥ US: –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –°–®–ê (–í–∏—Ä–¥–∂–∏–Ω–∏—è)
–®–∞—Ä–¥ APAC: –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ê–∑–∏–∏ (–¢–æ–∫–∏–æ)
```

**–ü—Ä–∏–º–µ—Ä:**

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ –ì–µ—Ä–º–∞–Ω–∏–∏
INSERT INTO users (id, name, region) VALUES (1, 'Hans', 'EU');
-- ‚Üí –®–∞—Ä–¥ EU (–ò—Ä–ª–∞–Ω–¥–∏—è)

-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ –Ø–ø–æ–Ω–∏–∏
INSERT INTO users (id, name, region) VALUES (2, 'Yuki', 'APAC');
-- ‚Üí –®–∞—Ä–¥ APAC (–¢–æ–∫–∏–æ)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–ù–∏–∑–∫–∞—è latency:** –î–∞–Ω–Ω—ã–µ –±–ª–∏–∑–∫–æ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
- **Compliance:** GDPR —Ç—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –µ–≤—Ä–æ–ø–µ–π—Ü–µ–≤ –≤ –ï–≤—Ä–æ–ø–µ.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **–°–ª–æ–∂–Ω–æ—Å—Ç—å cross-region –∑–∞–ø—Ä–æ—Å–æ–≤:** –ï—Å–ª–∏ –Ω–µ–º–µ—Ü–∫–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä –∏–∑ –Ø–ø–æ–Ω–∏–∏, –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –≤ –æ–±–∞ —Ä–µ–≥–∏–æ–Ω–∞.

### Latency-aware Routing

–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –±–ª–∏–∂–∞–π—à–µ–º—É –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä—É.

```plaintext
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –õ–æ–Ω–¥–æ–Ω–µ:
  DNS ‚Üí –±–ª–∏–∂–∞–π—à–∏–π —Å–µ—Ä–≤–µ—Ä: EU (–ò—Ä–ª–∞–Ω–¥–∏—è, 20 –º—Å)

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –°–∏–¥–Ω–µ–µ:
  DNS ‚Üí –±–ª–∏–∂–∞–π—à–∏–π —Å–µ—Ä–≤–µ—Ä: APAC (–°–∏–Ω–≥–∞–ø—É—Ä, 30 –º—Å)
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**

1. **GeoDNS:** DNS –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç IP –±–ª–∏–∂–∞–π—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞.
2. **Anycast:** –û–¥–∏–Ω IP-–∞–¥—Ä–µ—Å –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ª–æ–∫–∞—Ü–∏–π, BGP –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –∫ –±–ª–∏–∂–∞–π—à–µ–π.
3. **CDN:** Cloudflare, Fastly –∫—ç—à–∏—Ä—É—é—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –≤ 200+ —Ç–æ—á–∫–∞—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è.

### –ú—É–ª—å—Ç–∏—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ë–î

–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∏–µ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏.

**–ü—Ä–∏–º–µ—Ä—ã:**

- **CockroachDB:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≥–µ–æ-–ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **Google Spanner:** Multi-region consistency (linearizability —á–µ—Ä–µ–∑ –∞—Ç–æ–º–Ω—ã–µ —á–∞—Å—ã).
- **AWS Aurora Global Database:** –†–µ–ø–ª–∏–∫–∞—Ü–∏—è <1 —Å–µ–∫ –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏.
- **MongoDB Atlas:** Global Clusters —Å –∑–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º.

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

```plaintext
          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
          ‚îÇ   –ö–ª–∏–µ–Ω—Ç    ‚îÇ
          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                ‚îÇ
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚Üì                ‚Üì
   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚îÇ  EU DC  ‚îÇ ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ‚Üí ‚îÇ US DC   ‚îÇ
   ‚îÇ Primary ‚îÇ Replic ‚îÇ Replica ‚îÇ
   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ation ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚Üë                 ‚Üë
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚Üì
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ APAC DC ‚îÇ
           ‚îÇ Replica ‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Trade-offs:**

- **Latency –∑–∞–ø–∏—Å–∏:** –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –º–µ–∂–¥—É —Ä–µ–≥–∏–æ–Ω–∞–º–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç latency (100-200 –º—Å).
- **Consistency:** Eventual consistency (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è) –∏–ª–∏ Strong consistency (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è, –º–µ–¥–ª–µ–Ω–Ω–µ–µ).

---

## 8) –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ (Load Balancing)

–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏.

### –£—Ä–æ–≤–Ω–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

#### L4 (Transport Layer) ‚Äî –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ TCP/UDP

–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –æ–¥–Ω–æ–º—É –∏–∑ backend-—Å–µ—Ä–≤–µ—Ä–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ IP:Port.

```plaintext
–ö–ª–∏–µ–Ω—Ç (IP: 1.2.3.4)
      ‚Üì
–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ (—Å–º–æ—Ç—Ä–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ IP:Port)
      ‚Üì
Backend 1 (10.0.1.10:8080) –∏–ª–∏ Backend 2 (10.0.1.11:8080)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–°–∫–æ—Ä–æ—Å—Ç—å:** –ù–µ –ø–∞—Ä—Å–∏—Ç HTTP, —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ.
- **–ü—Ä–æ—Ç–æ–∫–æ–ª—å–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:** –†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º TCP/UDP —Ç—Ä–∞—Ñ–∏–∫–æ–º (HTTP, WebSocket, MySQL, Redis).

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **–ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:** –ù–µ –≤–∏–¥–∏—Ç HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–∏, cookies, URL.
- **Sticky sessions:** –°–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** HAProxy (L4 mode), NGINX (stream module), AWS NLB (Network Load Balancer).

#### L7 (Application Layer) ‚Äî –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ HTTP

–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –ø–∞—Ä—Å–∏—Ç HTTP-–∑–∞–ø—Ä–æ—Å –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ URL, –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, cookies.

```plaintext
–ö–ª–∏–µ–Ω—Ç
  ‚Üì
  GET /api/users HTTP/1.1
  Host: example.com
  Cookie: session_id=abc123
  ‚Üì
–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ (–ø–∞—Ä—Å–∏—Ç HTTP)
  ‚Üì
  URL = /api/users ‚Üí Backend API (10.0.2.10)
  URL = /static/* ‚Üí Backend CDN (10.0.3.10)
  Cookie session_id ‚Üí Backend 1 (sticky session)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- **–£–º–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è:** –ü–æ URL, –∑–∞–≥–æ–ª–æ–≤–∫–∞–º, –º–µ—Ç–æ–¥–∞–º (GET/POST).
- **SSL termination:** –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç HTTPS, backend –ø–æ–ª—É—á–∞–µ—Ç HTTP.
- **–ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:** –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤, URL rewrite.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**

- **–ú–µ–¥–ª–µ–Ω–Ω–µ–µ L4:** –ù—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å HTTP.
- **–¢–æ–ª—å–∫–æ HTTP/HTTPS:** –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** HAProxy (L7 mode), NGINX, Envoy, AWS ALB (Application Load Balancer).

### –ê–ª–≥–æ—Ä–∏—Ç–º—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

#### 1. Round Robin

–ó–∞–ø—Ä–æ—Å—ã —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ –∫—Ä—É–≥—É.

```plaintext
–ó–∞–ø—Ä–æ—Å 1 ‚Üí Backend 1
–ó–∞–ø—Ä–æ—Å 2 ‚Üí Backend 2
–ó–∞–ø—Ä–æ—Å 3 ‚Üí Backend 3
–ó–∞–ø—Ä–æ—Å 4 ‚Üí Backend 1
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –ü—Ä–æ—Å—Ç–æ—Ç–∞, —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ).

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:** –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É (–æ–¥–∏–Ω backend –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω).

#### 2. Least Connections

–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ backend —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

```plaintext
Backend 1: 5 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
Backend 2: 2 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è  ‚Üê –≤—ã–±–∏—Ä–∞–µ–º
Backend 3: 8 –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –£—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â—É—é –Ω–∞–≥—Ä—É–∑–∫—É.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:** –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ (–æ–¥–∏–Ω –¥–æ–ª–≥–∏–π –∑–∞–ø—Ä–æ—Å vs 100 –±—ã—Å—Ç—Ä—ã—Ö).

#### 3. Weighted Round Robin

Backend-–∞–º –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è –≤–µ—Å–∞ (–º–æ—â–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ–ª—É—á–∞—é—Ç –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤).

```plaintext
Backend 1 (–≤–µ—Å 3): –ø–æ–ª—É—á–∞–µ—Ç 3 –∑–∞–ø—Ä–æ—Å–∞ –∏–∑ 6
Backend 2 (–≤–µ—Å 2): –ø–æ–ª—É—á–∞–µ—Ç 2 –∑–∞–ø—Ä–æ—Å–∞ –∏–∑ 6
Backend 3 (–≤–µ—Å 1): –ø–æ–ª—É—á–∞–µ—Ç 1 –∑–∞–ø—Ä–æ—Å –∏–∑ 6
```

#### 4. IP Hash / Consistent Hashing

–ó–∞–ø—Ä–æ—Å—ã –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤—Å–µ–≥–¥–∞ –∏–¥—É—Ç –Ω–∞ –æ–¥–∏–Ω backend.

```python
backend_id = hash(client_ip) % num_backends
```

**–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:** Sticky sessions (–µ—Å–ª–∏ backend —Ö—Ä–∞–Ω–∏—Ç —Å–µ—Å—Å–∏—é –≤ –ø–∞–º—è—Ç–∏).

**–£–ª—É—á—à–µ–Ω–∏–µ:** Consistent hashing –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ backend.

#### 5. Least Response Time

–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ backend —Å –Ω–∞–∏–º–µ–Ω—å—à–∏–º —Å—Ä–µ–¥–Ω–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –æ—Ç–≤–µ—Ç–∞.

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –ê–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ backend.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:** –¢—Ä–µ–±—É–µ—Ç —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.

### Health Checks

–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å backend.

```plaintext
–ö–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥:
  GET /health ‚Üí Backend 1: 200 OK ‚úÖ
  GET /health ‚Üí Backend 2: 500 Error ‚ùå (–∏—Å–∫–ª—é—á–∞–µ–º –∏–∑ –ø—É–ª–∞)
  GET /health ‚Üí Backend 3: 200 OK ‚úÖ
```

**–¢–∏–ø—ã health checks:**

1. **Passive:** –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö.
2. **Active:** –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ endpoint `/health`.

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ HAProxy:**

```haproxy
backend api_servers
    balance roundrobin
    option httpchk GET /health
    http-check expect status 200
    
    server api1 10.0.1.10:8080 check inter 5s fall 3 rise 2
    server api2 10.0.1.11:8080 check inter 5s fall 3 rise 2
    server api3 10.0.1.12:8080 check inter 5s fall 3 rise 2
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

- `inter 5s` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥.
- `fall 3` ‚Äî –∏—Å–∫–ª—é—á–∏—Ç—å backend –ø–æ—Å–ª–µ 3 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.
- `rise 2` ‚Äî –≤–µ—Ä–Ω—É—Ç—å backend –ø–æ—Å–ª–µ 2 —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫.

### Consistent Hashing –≤ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞—Ö

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç consistent hashing –¥–ª—è –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è —Å–µ—Å—Å–∏–π –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø—É–ª–∞ backend.

**NGINX Plus:**

```nginx
upstream backend {
    hash $request_uri consistent;  # Consistent hashing –ø–æ URL
    server 10.0.1.10:8080;
    server 10.0.1.11:8080;
    server 10.0.1.12:8080;
}
```

**Envoy Proxy:**

```yaml
clusters:
  - name: backend_cluster
    lb_policy: RING_HASH  # Consistent hashing
    ring_hash_lb_config:
      minimum_ring_size: 1024
    endpoints:
      - lb_endpoints:
        - endpoint:
            address: { socket_address: { address: 10.0.1.10, port_value: 8080 }}
        - endpoint:
            address: { socket_address: { address: 10.0.1.11, port_value: 8080 }}
```

---

## 9) –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Consistent Hashing —Å —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π

–°–æ–∑–¥–∞–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ —É–∑–ª–æ–≤.

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Consistent Hashing:**
   - –ö–ª–∞—Å—Å `ConsistentHash` —Å –º–µ—Ç–æ–¥–∞–º–∏ `add_node()`, `remove_node()`, `get_node(key)`.
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ–¥ (configurable).

2. **–°–∏–º—É–ª—è—Ü–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è:**
   - –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ 10,000 –∫–ª—é—á–µ–π (`user_0`, `user_1`, ..., `user_9999`).
   - –†–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –∏—Ö –ø–æ 4 —É–∑–ª–∞–º (`Node_A`, `Node_B`, `Node_C`, `Node_D`).
   - –í—ã–≤–µ–¥–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É: —Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π –Ω–∞ –∫–∞–∂–¥–æ–º —É–∑–ª–µ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å).

3. **–°–∏–º—É–ª—è—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É–∑–ª–∞:**
   - –î–æ–±–∞–≤—å—Ç–µ 5-–π —É–∑–µ–ª (`Node_E`).
   - –ü–æ–¥—Å—á–∏—Ç–∞–π—Ç–µ, —Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–æ—Å—å (–∏–∑–º–µ–Ω–∏–ª–∏ —É–∑–µ–ª).
   - –í—ã–≤–µ–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ–Ω—Ç –ø–µ—Ä–µ–º–µ—â—ë–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ~20%).

4. **–°–∏–º—É–ª—è—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è —É–∑–ª–∞:**
   - –£–¥–∞–ª–∏—Ç–µ `Node_B`.
   - –ü–æ–¥—Å—á–∏—Ç–∞–π—Ç–µ, —Å–∫–æ–ª—å–∫–æ –∫–ª—é—á–µ–π –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–æ—Å—å.
   - –í—ã–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.

5. **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):**
   - –ü–æ—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä–∞—Ñ–∏–∫ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–ª—é—á–µ–π –ø–æ —É–∑–ª–∞–º (–¥–æ/–ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π).

### –®–∞–±–ª–æ–Ω –∫–æ–¥–∞

```python
import hashlib
from collections import defaultdict

class ConsistentHash:
    def __init__(self, num_virtual_nodes=150):
        self.num_virtual_nodes = num_virtual_nodes
        self.ring = {}  # {hash_value: node_name}
        self.sorted_keys = []

    def _hash(self, key):
        return int(hashlib.md5(key.encode()).hexdigest(), 16)

    def add_node(self, node_name):
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º–∏ –Ω–æ–¥–∞–º–∏
        pass

    def remove_node(self, node_name):
        # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —É–∑–ª–∞
        pass

    def get_node(self, key):
        # TODO: –ù–∞–π—Ç–∏ —É–∑–µ–ª –¥–ª—è –∫–ª—é—á–∞ (–±–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∫–æ–ª—å—Ü—É)
        pass

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
ch = ConsistentHash(num_virtual_nodes=150)
nodes = ['Node_A', 'Node_B', 'Node_C', 'Node_D']
for node in nodes:
    ch.add_node(node)

# –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–ª—é—á–µ–π
keys = [f'user_{i}' for i in range(10000)]
distribution = defaultdict(int)
key_mapping = {}

for key in keys:
    node = ch.get_node(key)
    distribution[node] += 1
    key_mapping[key] = node

print("–ù–∞—á–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ:")
for node, count in sorted(distribution.items()):
    print(f"{node}: {count} –∫–ª—é—á–µ–π ({count/len(keys)*100:.1f}%)")

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∑–ª–∞
ch.add_node('Node_E')
moved_keys = 0
new_distribution = defaultdict(int)

for key in keys:
    new_node = ch.get_node(key)
    new_distribution[new_node] += 1
    if key_mapping[key] != new_node:
        moved_keys += 1

print(f"\n–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è Node_E:")
print(f"–ü–µ—Ä–µ–º–µ—â–µ–Ω–æ –∫–ª—é—á–µ–π: {moved_keys} ({moved_keys/len(keys)*100:.1f}%)")
for node, count in sorted(new_distribution.items()):
    print(f"{node}: {count} –∫–ª—é—á–µ–π ({count/len(keys)*100:.1f}%)")
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å (40%):** Consistent hashing —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ.
- **–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç—å (20%):** –ö–ª—é—á–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ (¬±5% –æ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ).
- **–ú–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è (20%):** –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É–∑–ª–∞ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è ~20% –∫–ª—é—á–µ–π.
- **–ö–æ–¥ (10%):** –ß–∏—Å—Ç—ã–π, —á–∏—Ç–∞–µ–º—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏.
- **–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (10%):** –ì—Ä–∞—Ñ–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [Dynamo Paper (2007)](https://www.allthingsdistributed.com/files/amazon-dynamo-sosp2007.pdf) ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç—å—è Amazon –æ consistent hashing –∏ eventual consistency
- [Designing Data-Intensive Applications](https://dataintensive.net/) ‚Äî –≥–ª–∞–≤–∞ 6 –æ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
- [Consistent Hashing Visualizer](https://tom-e-white.com/2007/11/consistent-hashing.html) ‚Äî –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- [HAProxy Documentation](https://www.haproxy.org/) ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
- [NGINX Load Balancing](https://docs.nginx.com/nginx/admin-guide/load-balancer/) ‚Äî –∞–ª–≥–æ—Ä–∏—Ç–º—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
- [MongoDB Sharding Architecture](https://www.mongodb.com/docs/manual/sharding/) ‚Äî –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- [Cassandra Architecture](https://cassandra.apache.org/doc/latest/architecture/dynamo.html) ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è consistent hashing –≤ production

---

## –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

1. –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–º –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º? –ö–æ–≥–¥–∞ –∫–∞–∂–¥—ã–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª–µ–Ω?
2. –û–ø–∏—à–∏—Ç–µ —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —à–∞—Ä–¥–∏–Ω–≥–∞ (range, hash, composite). –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é?
3. –ö–∞–∫ consistent hashing —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–∑–ª–æ–≤?
4. –ß—Ç–æ —Ç–∞–∫–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –Ω–æ–¥—ã –≤ consistent hashing –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã?
5. –ß—Ç–æ —Ç–∞–∫–æ–µ hotspot –∏ –∫–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –±–æ—Ä—å–±—ã —Å –Ω–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—Ç?
6. –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ –∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏? –ö–∞–∫–∏–µ trade-offs?
7. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥–µ–æ-—à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ—á–µ–º—É –æ–Ω–æ –≤–∞–∂–Ω–æ –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π?
8. –í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–æ–π L4 –∏ L7? –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∂–¥—É—é?
9. –û–ø–∏—à–∏—Ç–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ (Round Robin, Least Connections, Consistent Hashing). –ü–ª—é—Å—ã/–º–∏–Ω—É—Å—ã –∫–∞–∂–¥–æ–≥–æ.
10. –ö–∞–∫ health checks –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã?
11. –ü–æ—á–µ–º—É –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —É–∑–ª–∞ –≤ consistent hashing –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ ~1/N –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ –≤—Å–µ?
12. –ö–∞–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç (fixed partitions, dynamic, proportional)?

---

**–ò—Ç–æ–≥:** –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—ã—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º. Consistent hashing –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç–æ–ø–æ–ª–æ–≥–∏–∏, –∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –≤—ã—Å–æ–∫—É—é –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å. –ö–æ–º–±–∏–Ω–∏—Ä—É—è —ç—Ç–∏ –ø–æ–¥—Ö–æ–¥—ã —Å –≥–µ–æ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º, –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—ã, –æ–±—Å–ª—É–∂–∏–≤–∞—é—â–∏–µ –º–∏–ª–ª–∏–∞—Ä–¥—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É! üåç‚öñÔ∏è
